/********************************************************************
*	Author: 		Jim English										*	
*	Company: 		JRE Solutions Ltd								*	
*	Description: 	A configuration tool for built for the NHS.		*
********************************************************************/
var stylesheetPath = 'path to stylesheet',											// path to CSS stylesheet file
	javaScriptPath = 'path to javascript',											// path to Javascript file
	apiKey = 'PHRJCDTY',															// carers service API key
	defaultWidth = 600,																// default width of widget
	subjectsUrl = 'http://v1.syndication.nhschoices.nhs.uk/conditions/subjects',	// subjects url
	azUrl = 'http://v1.syndication.nhschoices.nhs.uk/conditions/atoz';				// a-z URL 
(function(c,b,a,d){c(function(){var k=0,g=c("#nhs-tree").attr("level",1),f=c("#width").val(defaultWidth),j=true,h=c("#widget-title");function e(n,m){var o="http"+(/^https/.test(b.location.protocol)?"s":""),l=c(".loader");c.getJSON(o+"://query.yahooapis.com/v1/public/yql?callback=?",{q:'select * from xml where url="'+n+".xml?apikey="+apiKey+'"',format:"json",diagnostics:true},function(s){var w=(s&&s.query&&s.query.results&&s.query.results.ArrayOfLink)?s.query.results.ArrayOfLink.Link:[],r,u=[],x,q="",p=Number(m.attr("level"));w=(c.isArray(w))?w:[w];for(var t=0,v=w.length;t<v;t++){r=w[t];if(!r){break}if(r.Uri){x='<ul level="'+(p+1)+'" />'}if(p<3){q='<a class="toggler" href="'+r.Uri+'"></a>'}if(r.Uri&&r.Uri.indexOf("mapofmedicinepage")<0){u.push('<li level="'+p+'">'+q+'<label><input level="'+p+'" jr-label="'+r.Text+'" type="checkbox" name="url" value="'+r.Uri+'"/><span class="input-label">'+r.Text+"</span></label>"+(p==3?'<a class="editLabelLnk" href="#">edit label</a>':"")+x+"</li>")}x="";k++}m.data("loaded",true);m.append(u.join(""));l.remove()})}function i(l,m){var p=l.find("a"),o=l.find("ul"),q=l.find('input[type="checkbox"]'),n=q.val().split("?")[0];if(!o.data("loaded")){e(n,o)}if(!m){o.toggleClass("open");p.toggleClass("open")}else{o.addClass("open");p.first().addClass("open")}}g.delegate("a","click",function(){i(c(this).parent());this.blur();return false});g.delegate('ul[level="3"] li',"hover",function(l){c(this).find(".editLabelLnk").css("display",l.type==="mouseenter"?"inline":"none")});g.delegate(".editLabelLnk","click",function(){var l=c(this),m=l.offset(),n=l.parent("li").find("input");c("#editLabel").show().css({position:"absolute",top:m.top,left:m.left}).val(n.attr("jr-label")).focus().data("element-ref",n);l.hide();return false});g.delegate('input[type="checkbox"]',"click",function(n){var l=c(this),m=l.parents("li");if(h.val()===""){h.val(l.parents('li[level="2"]').find("input").first().attr("jr-label"))}if(l.is(":checked")){i(l.parents("li").first(),true);m.each(function(){var o=c(this).children("label").find("input").first();if(o.val()!==l.val()){o.attr("checked","checked")}})}else{m.first().find('input[type="checkbox"]').attr("checked","")}});c("#editLabel").keypress(function(n){var l=c(this),m=l.data("element-ref");if(n.which==13){l.hide();if(m&&m.length){m.attr("jr-label",this.value);m.parent("label").find(".input-label").html(this.value)}}}).blur(function(){c(this).hide()});c("#generate").click(function(){var l="http://v1.syndication.nhschoices.nhs.uk/conditions/articles/",m={articles:[]};g.find('input[level="2"]:checked').each(function(){tObj={url:this.value.substring(l.length).split("?")[0],label:c(this).attr("jr-label"),children:[]};c(this).parents('li[level="2"]').first().find('input[level="3"]:checked').each(function(){tObj.children.push({url:this.value.substring(l.length).split("?")[0],label:c(this).attr("jr-label")})});m.articles.push(tObj)});m.headingText=h.val();c("#first-page").slideUp(1000,function(){var o=Math.floor(Math.random()*101),n=c("#nhs-impl");c("#second-page").show();c("#nhs-head-code").html('&lt;link rel="stylesheet" media="screen" type="text/css" href="'+stylesheetPath+'"&gt;').select();c("#nhs-code").html(unescape('&lt;div id="nhs-widget-'+o+'"'+((f.val()==="")?"":'style="width:'+(Number(f.val())||defaultWidth)+'px;"')+'&gt;&lt;/div&gt;%0A&lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"&gt;&lt;/script&gt;%0A&lt;script type="text/javascript" src="'+javaScriptPath+'"&gt;&lt;/script&gt;%0A&lt;script type="text/javascript"&gt;%0A$(function(){%0A$(\'#nhs-widget-'+o+"').nhsAZWidget("+c.toJSON(m)+");%0A});\n&lt;/script&gt;")).select();n.data("nhsAZWidget",null);n.html("").nhsAZWidget(m)});this.blur();return false});c("#back").click(function(){c("#second-page").hide();c("#first-page").slideDown(1000);this.blur();return false});c("#popup button").click(function(){e(this.id=="azBtn"?azUrl:subjectsUrl,g);c("#popup ").hide()})})}(jQuery,window,document));