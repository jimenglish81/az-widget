/********************************************************************
*	Author: 		Jim English										*	
*	Company: 		JRE Solutions Ltd								*	
*	Description: 	An AZ widget for built for the NHS.				*
********************************************************************/
var nhsAZDefaults = {
	serviceURL: 'http://v1.syndication.nhschoices.nhs.uk/conditions',				// az service url to be used
	apiKey: 'PHRJCDTY',																// az service api key
	articles: [],																	// article holder
	imgUrl: '../img/nhs_choices.gif',														// logo url
	titleText: 'conditions',														// title logo
	headingText: 'NHS Widget',														// heading of widget
	noResults: 'Sorry please try again later.',										// error message
	logoUrl: 'http://www.nhs.uk'													// logo link url
};
(function(c,b,a,d){c.nhsAZWidget=function(g,s){var A,f,v,k,B,o,j,w,m,p;s=c.extend(true,{},c.nhsAZWidget.defaults,s);v=s.articles;f=s.serviceURL+"/articles";A=s.apiKey;cache={};k=b.location.href.substring(0,b.location.href.lastIndexOf("/")+1);B=c(g).append('<div id="az-nhs-widget"><div class="nhs-widget-inner"></div></div>').find(".nhs-widget-inner");w=B.append('<div class="nhs-widget-header"><div class="nhs-widget-logo"><a href="'+s.logoUrl+'" target="_blank"><img src="'+s.imgUrl+'" alt="nhs choices"/><span>'+s.titleText+'</span></a></div><h2 class="nhs-widget-title">'+s.headingText+"</h2></div>").find("nhs-widget-title");o=B.append('<ul class="nhs-widget-nav nhs-widget-clear" />').find(".nhs-widget-nav");p=B.append('<div class="nhs-widget-tabs nhs-widget-clear"><div class="nhs-widget-tab"><div class="nhs-widget-video"></div><div class="nhs-widget-content"></div></div></div>').find(".nhs-widget-tab");j=B.find(".nhs-widget-content");m=B.find(".nhs-widget-video");function t(D,C){if(!C.children){return}for(var E=0,y=C.children.length;E<y;E++){h(C.children[E],E);if(E===0){q(C.children[E].url)}}}function h(C,l){var y=((l==0)?"nhs-widget-first nhs-widget-active":"")+"";o.append('<li class="'+y+'"><a href="'+C.url+'">'+C.label+"</a></li>")}function q(i){i=f+"/"+i;j.empty();m.empty();if(cache[i]){setTimeout(function(){p.removeClass("nhs-widget-loader");m.append(cache[i].video);j.append(cache[i].content)},200)}else{r(i,function(C){var y=C&&C.query.results&&C.query.results.feed?C.query.results.feed.entry:{},D=c(y.content?y.content.content:"").find("a").attr("target","_blank").end(),l=c(y.videoEmbedCodes&&y.videoEmbedCodes.videoEmbedCode);if(D.length){p.removeClass("nhs-widget-loader");m.append(l);j.append(D);cache[i]={content:D,video:l}}else{p.removeClass("nhs-widget-loader");j.html('<div class="nhs-widget-error">'+s.noResults+"</div>")}})}}function r(i,y){var l="http"+(/^https/.test(b.location.protocol)?"s":"");c.getJSON(l+"://query.yahooapis.com/v1/public/yql?callback=?",{q:'select * from xml where url="'+i+".xml?apikey="+A+'"',format:"json",diagnostics:true},y)}o.delegate("a","click",function(){var i=c(this),l=i.parent("li");if(l.hasClass("nhs-widget-active")){return false}p.addClass("nhs-widget-loader");o.find(".nhs-widget-active").removeClass("nhs-widget-active");l.addClass("nhs-widget-active");q(i.attr("href").replace(k,""));return false});p.addClass("nhs-widget-loader");if(v.length>1){var e=[];for(var x=0,u=v.length;x<u;x++){for(var n=0,z=v[x].children.length;n<z;n++){e.push(v[x].children[n])}}t(f,{children:e})}else{t(f,v[0])}};c.nhsAZWidget.defaults=nhsAZDefaults;c.nhsAZWidget.widgets=0;c.fn.extend({nhsAZWidget:function(e){e=e||{};this.each(function(){var f=c.data(this,"nhsAZWidget");if(!f){c.data(this,"nhsAZWidget",new c.nhsAZWidget(this,e))}});return this}})}(jQuery,window,document));